<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Analisis Sentimen Kinerja DPR</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="{{url_for('static', filename='css/styles.css')}}" rel="stylesheet" />
        <link href="https://cdn.datatables.net/1.13.2/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand" href="#page-top">Analisis Sentimen Kinerja DPR</a>
                <button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="#klasifikasi">Klasifikasi</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="#rekap">Rekap</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="#about">About</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="/labelling">Labelling</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead bg-primary text-white text-center">
            <div class="container d-flex align-items-center flex-column">
                <!-- Masthead Avatar Image-->
                <!--<img class="masthead-avatar mb-5" src="{{url_for('static', filename='assets/img/puan.jpg')}}" width="40px">-->
                <!-- <h1 class="gmbr-team"> <img src="{{url_for('static', filename='static/img/comment.png')}}" width="40px"><
                <!-- Masthead Heading-->
                <h1 class="masthead-heading text-uppercase mb-0">Analisis Sentimen Kinerja DPR</h1>
                <!-- Icon Divider-->
                <div class="divider-custom divider-light">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
                <!-- Masthead Subheading-->
                <p class="masthead-subheading font-weight-light mb-0">Selamat Datang di Aplikasi Analisis Sentimen Kinerja DPR</p>
            </div>
        </header>
        <!-- Klasifikasi Section-->
        <section class="page-section klasifikasi" id="klasifikasi">
            <div class="container">
                <!-- Portfolio Section Heading-->
                <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">Klasifikasi</h2>
                <!-- Icon Divider-->
                <div class="divider-custom">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
              <!-- klasifikasi-->
        <section class="page-section" id="klasifikasi">
            <div class="container">
                <div class="text-center">
                        <h1><strong>KLASIFIKASI</strong></h1>
                            <div class="row">
                        <div class="text-center">
                            <form id="form-sentimen" action="/predict" method="POST" class="form" autocomplete="off" enctype="multipart/form-data">
                            <div class="text">
                                <label for="exampleInputEmail1" class="form-label">Masukan Kalimat disini:</label>
                                <input type="text" class="form-control" name="Reviews" placeholder="Masukkan kalimat disini!"></input>
                                <br>  
                                <br>
                                <br><input type="submit" class="btn btn-info" name="submit" id="btn"></input><br><br>
                                <table id="tbl_prediksi" class="display" style="width:100%" hidden>
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Tweet</th>
                                            <th>Labelling</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                            </form>
                        </div>
                            <div class="text-center">
                            <h3>HASIL</h3>
                            <h5><strong>Sentimen dari text : </strong></h5> <h2>{{ Reviews }} </h2>
                            <div>
                            <h5>Adalah </h5>
                            {% if prediction == 'Positif' %}
                            <h2 style="color:rgb(0, 255, 0);">Positif</h2>
                            {% elif prediction == 'negatif' %}
                            <h2 style="color:rgb(47, 0, 255);">Negatif</h2>
                            {% endif %}
                            </div>
                        </div>
                        </div>
                </form>
                </div>
            </div>
        </section>

        <section class="page-section" id="upload">
            <div class="container">
                <!-- Portfolio Section Heading-->
                <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">UPLOAD</h2>
                <!-- Icon Divider-->
                <div class="divider-custom">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
            <div class="container">
                <div class="text-center">
                        <h1><strong>UPLOAD</strong></h1>
                        <div class="row">
                        <div class="text-center">
                            <form id="form-sentimen" action="/upload" method="POST" class="form" autocomplete="off" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="formFile" class="form-label">Pilih File</label>
                                    <input class="form-control" type="file" id="formFile" name="file">
                                </div>    
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </form>
                        </div>    
                        </div>
                </form>
                </div>
            </div>
        </section>

        <section class="page-section rekap" id="rekap" enctype="multipart/form-data">
            <div class="container">
                <!-- Portfolio Section Heading-->
                <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">REKAP</h2>
                <!-- Icon Divider-->
                <div class="divider-custom">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
              <!-- klasifikasi-->
        <section class="page-section" id="rekap">
            <div class="container">
                <div class="text-center">
                        <h1><strong>REKAP</strong></h1>
                            <div class="row">
                        <div class="text-center">
                            <form method="POST" action="/cari">
                                  <div class="mt-3 mb-3">
                                    <select id="bulan" name="bulan" class="form-select">
                                        <option value="0" selected disabled>Pilih Bulan</option>
                                        <option value="1">Januari</option>
                                        <option value="2">Februari</option>
                                        <option value="3">Maret</option>
                                        <option value="4">April</option>
                                        <option value="5">Mei</option>
                                        <option value="6">Juni</option>
                                        <option value="7">Juli</option>
                                        <option value="8">Agustus</option>
                                        <option value="9">September</option>
                                        <option value="10">Oktober</option>
                                        <option value="11">November</option>
                                        <option value="12">Desember</option>
                                        <option value="all">Semua</option>
                                    </select>
                                  </div>
                                  <div class="mt-3 mb-3">
                                    <select id="tahun" name="tahun" class="form-select">
                                        <option value="0" selected disabled>Pilih Tahun</option>
                                        <option value="2022">2022</option>
                                        <option value="2023">2023</option>
                                        <option value="2024">2024</option>
                                        <option value="2025">2025</option>
                                        <option value="2026">2026</option>
                                        <option value="2027">2027</option>
                                    </select>
                                  </div>
                                  <input type='button' class="btn btn-primary mb-3" onclick='updateStatus()' value='Submit'>
                                  <table id="example" class="display" style="width:100%" hidden>
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Tweet</th>
                                            <th>Labelling</th>
                                        </tr>
                                    </thead>
                                </table>
                                  <div id="btn_export"></div>
                              </form>
                                <center><div class="container" id="cnv" style="position: relative; height:80vh; width:80vw">
                                    <canvas id="myChart"></canvas>
                                    <div id="error"></div>
                                </div></center>
                        </div>                           
                        </div>
                        </div>
                </form>
                </div>
            </div>
            
        </section>
        <!-- About Section-->
        <section class="page-section bg-primary text-white mb-0" id="about">
            <div class="container">
                <!-- About Section Heading-->
                <h2 class="page-section-heading text-center text-uppercase text-white">About</h2>
                <!-- Icon Divider-->
                <div class="divider-custom divider-light">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
                <!-- About Section Content-->
                <div class="row">
                    <div class="col-lg-4 ms-auto"><p class="lead">Sistem Analisis Sentimen Kinerja DPR ini digunakan untuk mengetahui pendapat masyarakat mengenai lembaga DPR </p></div><br>
                    <div class="col-lg-4 me-auto"><p class="lead">Sistem analisis sentimen ini dibangun mengguakan algoritma Naive Bayes </p></div>
                </div>
            </div>
        </section>
        <!-- Footer-->
        <footer class="footer text-center">
            <div class="container">
                <div class="row">
                    <!-- Footer Location-->
                    <!--<div class="col-lg-4 mb-5 mb-lg-0">
                        <h4 class="text-uppercase mb-4">Location</h4>
                        <p class="lead mb-0">
                            2215 John Daniel Drive
                            <br />
                            Clark, MO 65243
                        </p>
                    </div>-->
                    <!-- Footer Social Icons-->
                    <div class="text-center">
                        <h4 class="text-uppercase mb-4">Follow Me</h4>
                        <a class="btn btn-outline-light btn-social mx-1" href="#!"><i class="fab fa-fw fa-facebook-f"></i></a>
                        <a class="btn btn-outline-light btn-social mx-1" href="#!"><i class="fab fa-fw fa-twitter"></i></a>
                        <a class="btn btn-outline-light btn-social mx-1" href="#!"><i class="fab fa-fw fa-linkedin-in"></i></a>
                        <a class="btn btn-outline-light btn-social mx-1" href="#!"><i class="fab fa-fw fa-dribbble"></i></a>
                    </div>
                    <!-- Footer About Text-->
                    <!--<div class="col-lg-4">
                        <h4 class="text-uppercase mb-4">About Freelancer</h4>
                        <p class="lead mb-0">
                            Freelance is a free to use, MIT licensed Bootstrap theme created by
                            <a href="http://startbootstrap.com">Start Bootstrap</a>
                            .
                        </p>
                    </div>-->
                </div>
            </div>
        </footer>
        <!-- Copyright Section-->
        <div class="copyright py-4 text-center text-white">
            <div class="container"><small>Copyright &copy; Analisis Sentimen Kinerja DPR</small></div>
        </div>
                <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    </body>
    <!--Load the AJAX API-->
    <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.13.2/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.2/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.4/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.4/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.4/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.4/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.4/js/buttons.colVis.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#tbl_prediksi').DataTable({   
                "dom": 'Bfrtip',
                "pageLength": 5, 
                "processing": true,
                "serverSide": true,
                bFilter: false,
                info: false,
                ordering: false,
                paging: false,
                        buttons: [
                'csv', 'excel', 'pdf'
            ],  
                "ajax": {
                    'url':'/data-prediksi'
                    
                },
                "columns": [
                        { data: 'kalimat' },
                        { data: 'labelling' },
                        { data: 'tanggal' }
                  ]
                  
            });
             
            
             table.buttons( 0, null ).containers().appendTo( '#btn_export' );

        } );
    </script>
        
    <script type="text/javascript">
        function updateStatus(){
            var opt = document.getElementById("bulan").value;
            var tahun = document.getElementById("tahun").value;
            console.log(opt);
            console.log(tahun);
            
            if(opt=='0' && tahun=='0'){  
                let chartStatus = Chart.getChart("myChart"); // <canvas> id
                const div = document.getElementById('error');
                div.innerHTML = '<h2 >Pilih Bulan dan Tahun Terlebih Dahulu</h2>';
            $("#myChart").hide();  
            }else if(opt == '0'){
                let chartStatus = Chart.getChart("myChart"); // <canvas> id
                const div = document.getElementById('error');
                div.innerHTML = '<h2 >Pilih Bulan Terlebih Dahulu</h2>';
                $("#myChart").hide();
            }else if(tahun == '0'){
                let chartStatus = Chart.getChart("myChart"); // <canvas> id
                const div = document.getElementById('error');
                div.innerHTML = '<h2 >Pilih Tahun Terlebih Dahulu</h2>';
                $("#myChart").hide();
            }else{
                var table = $('#example').DataTable();
                table.destroy();
            $.ajax({
                type: "POST",
                url: "get-data",
                data: {bulan: opt, tahun:tahun},
                success:function(data){
                    const div = document.getElementById('error');
                    div.innerHTML = '';
                    const table = document.getElementById('');
                    div.innerHTML = '';
                    $("#myChart").show();                    
                    if(opt == 'all'){
                        $(document).ready(function() {
                            $('#example').DataTable({   
                                "dom": 'Bfrtip',
                                "pageLength": 5, 
                                "processing": true,
                                "serverSide": true,
                                bFilter: false,
                                info: false,
                                ordering: false,
                                paging: false,
                                        buttons: [
                                'csv', 'excel', 'pdf'
                            ],  
                                "ajax": {
                                    'url':'/data-table?tahun='+tahun+'&bulan='+opt
                                    
                                },
                                "columns": [
                                        { data: 'date' },
                                        { data: 'tweet' },
                                        { data: 'labelling' }
                                  ]
                                  
                            });
                             
                            
                             table.buttons( 0, null ).containers().appendTo( '#btn_export' );
                
                        } );
                        var data_positif = [];
                        var data_negatif = [];
                        var month =[];
                        for (var pos of data[1].positif) {
                            data_positif.push(pos.count);
                        }
                        for (var neg of data[0].negatif) {
                            data_negatif.push(neg.count);
                        }
                        for (var mth of data[2].month) {
                            month.push(mth.month);
                        }
                        console.log(data_negatif)
                        console.log(data_positif)
                        if(data_positif.length == 0 && data_negatif.length == 0){
                            let chartStatus = Chart.getChart("myChart"); // <canvas> id
                            const div = document.getElementById('error');
                            div.innerHTML = '<h2 >Data Tidak Ada</h2>';
                            $("#myChart").hide();
                        }else{
                            $("#myChart").show();
                            var ctx = $("#myChart");
                            var data = {
                                labels: month,
                                datasets: [{
                                    data: data_positif,
                                    label: 'Positif',
                                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1,
                                    fill: 3,
                                },{
                                    data:data_negatif,
                                    label: 'Negatif',
                                    backgroundColor:'rgba(255, 99, 132, 0.2)',
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1,
                                    fill: 3,
                                }
                                ]
                            };
                        
                            //options
                            var options = {
                                responsive: true,
                                title: {
                                    position: "top",
                                    text: "Monthly Registered Users Count",
                                    fontSize: 18,
                                    fontColor: "#111"
                                },
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: true,
                                            userCallback: function(label, index, labels) {
                                                if (Math.floor(label) === label) {
                                                    return label;
                                                }
                        
                                            },
                                        }
                                    }],
                                },
                        
                            };
                            let chartStatus = Chart.getChart("myChart"); // <canvas> id
                                if (chartStatus != undefined) {
                                chartStatus.destroy();
                                }
                            
                            var chart = new Chart(ctx, {
                                type: "bar",
                                data: data,
                                options: options
                            });
                                
                            }
                    }else{
                        $(document).ready(function() {
                            $('#example').DataTable({   
                                "dom": 'Bfrtip',
                                "pageLength": 5, 
                                "processing": true,
                                "serverSide": true,
                                bFilter: false,
                                info: false,
                                ordering: false,
                                paging: false,
                                        buttons: [
                                'csv', 'excel', 'pdf'
                            ],  
                                "ajax": {
                                    'url':'/data-table?tahun='+tahun+'&bulan='+opt
                                    
                                },
                                "columns": [
                                        { data: 'date' },
                                        { data: 'tweet' },
                                        { data: 'labelling' }
                                  ]
                                  
                            });
                             
                            
                             table.buttons( 0, null ).containers().appendTo( '#btn_export' );
                
                        } );
                        var canvas = document.getElementById("myChart");
                        var ctx = $("#myChart");
                        console.log(data);
                        var data = {
                            labels: ["Positif", "Negatif"],
                              datasets: [
                                {
                                    fill: true,
                                    backgroundColor: ['rgba(54, 162, 235, 0.2)','rgba(255, 99, 132, 0.2)'],
                                    data: [data[1].count, data[0].count],
                                    borderColor:	['white', 'white'],
                                    borderWidth: [2,2]
                                }
                            ]
                        };
                                                    
                        var options = {
                                title: {
                                          display: true,
                                          text: 'What happens when you lend your favorite t-shirt to a girl ?',
                                          position: 'top'
                                      }
                                
                        };
                        
                        
                        // Chart declaration:
                        let chartStatus = Chart.getChart("myChart"); // <canvas> id
                            if (chartStatus != undefined) {
                              chartStatus.destroy();
                            }
                       
                            var myChart = new Chart(ctx, {
                                type: 'pie',
                                data: data,
                                options: options
                            });
                    }
                }
            }).fail(function(){
                let chartStatus = Chart.getChart("myChart"); // <canvas> id
                
                const div = document.getElementById('error');
                
                div.innerHTML = '<h2 >Data Tidak Ada</h2>';
                $("#myChart").hide();

            });
        }  
    }
    </script>

    
</html>
